<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>LTH</title>
    <link rel="stylesheet" href="lib/bootstrap.min.css">
</head>

<body>


    <div class="container">
        <h1>LTH</h1>
        <hr />
        <div class="page col-md-6"></div>
        <div class="page2 col-md-6"></div>
    </div>


    <script src="lib/jquery.min.js" type="text/javascript"></script>
    <script src="lib/underscore-min.js" type="text/javascript"></script>
    <script src="lib/backbone-min.js" type="text/javascript"></script>
    <script src="lib/bootstrap.min.js" type="text/javascript"></script>
    <script src="lib/backbone.localStorage-min.js" type="text/javascript"></script>
    <script src="courses.json" type="text/javascript"></script>


    <script type="text/template" id="home_template">
<table>
    <thead>
        <tr>
            <th>Code</th>
            <th>Name</th>
            <th>Credits</th>
            <th> </th>
        </tr>
    </thead>
    <tbody>
         <%  
        _.each(data,function(item){
        %>
            <tr>
                <!-- use variables -->
                <td>
                    <%= item.code %>
                </td>
                <td>
                    <%= item.name %>
                </td>
                <td>
                    <%= item.credits %>
                </td>
                <td>
                    <a href="#" class="btn" data-id=<%= item.id%>> LÃ¤gg till</a>
                </td>
            </tr>
            <% }); %>
    </tbody>
</table>
    </script>
    
    
    <script type="text/template" id="side_template">
<table>
    <thead>
        <tr>
            <th>Code</th>
            <th>Name</th>
            <th>Credits</th>
            <th> </th>
        </tr>
    </thead>
    <tbody>
         <% 
        _.each(data,function(item){
        %>
            <tr>
                <!-- use variables -->
                <td>
                    <%= item.code %>
                </td>
                <td>
                    <%= item.name %>
                </td>
                <td>
                    <%= item.credits %>
                </td>
                <td>
                    <a href="#" class="btn" data-id=<%= item.id%>> Ta bort</a>
                </td>
            </tr>
            <% }); %>
    </tbody>
</table>
    </script>

    <script type="text/template" id="test_test">
        <%= test %>
    </script>

    <script>
        var Course = Backbone.Model.extend({
            initialize: function () {
                //console.log("Hej hopp");
            },
        });

        var CourseList = Backbone.Collection.extend({
            localStorage: new Backbone.LocalStorage("SomeCollection"),
            model: Course,
            customFilter: function(filters){
				var results = this.where(filters);
				return new MyCollection(results);
			},
        });

        var courses = new CourseList();
        var coursesAdded = new CourseList();
        courses.add(ourData);

        var TestView = Backbone.View.extend({
            el: '.page',
            render: function () {
                var template = _.template($('#test_test').html());
                this.$el.html(template({
                    test: "Test"
                }));
            },
        });

        var lambda = function(item) {return true; };
        lambda = function(item){ return item.specialization == "ks"; };

        testView = new TestView();
        var HomeView = Backbone.View.extend({
            el: '.page',
            events: {
                "click a": "clicked"
            },
            dataSource: courses,
            temp: '#home_template',
            render: function () {

                console.log("render");
                var template = _.template($(this. temp).html());
                this.$el.html(template({
                    data: this.dataSource.toJSON(),

                }));
            },
            clicked: function(e){
                e.preventDefault();
                var id = $(e.currentTarget).data("id");
                var item = courses.get(id);
                coursesAdded.fetch();
                coursesAdded.add([item.clone()]);
                item.save();
                sideView.render();
                
            },
        });

        homeView = new HomeView();
        
        var SideView = HomeView.extend({
            temp: '#side_template',
            el: '.page2',
            dataSource: coursesAdded,
            clicked: function(e){
                e.preventDefault();
                var id = $(e.currentTarget).data("id");
                var item = coursesAdded.get(id);
                coursesAdded.fetch();
                item.destroy();
                sideView.render();
            }
        });
        
        sideView = new SideView();        

        /*
        var filteredCollection = myCollection.customFilter({});

        filteredHomeView = new HomeView({
        	collection: filteredCollection
        });
		*/

        var Router = Backbone.Router.extend({
            routes: {
                "test": "test",
                "": "home"
            }
        });
        
        var router = new Router;
        router.on('route:test', function () {
            testView.render();
        })
         router.on('route:home', function () {
            homeView.render();
            coursesAdded.fetch();
            sideView.render();
        })
         Backbone.history.start();



    </script>


</body>

</html>